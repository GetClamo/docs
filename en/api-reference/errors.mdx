---
title: Errors
description: Error codes, response formats, and common solutions
---

# Error Handling

Clamo APIs use standard HTTP codes and a consistent error format to facilitate problem diagnosis.

## Error Format

All errors follow this structure:

```json
{
  "error": {
    "code": "ERROR_CODE",
    "message": "Human-readable error description",
    "details": {
      // Additional error-specific information
    }
  }
}
```

## HTTP Codes

### Client Errors (4xx)

| Code | Name | Description |
|------|------|-------------|
| 400 | Bad Request | Request is invalid or malformed |
| 401 | Unauthorized | Authentication required or invalid |
| 403 | Forbidden | No permissions for resource |
| 404 | Not Found | Resource doesn't exist |
| 409 | Conflict | Conflict with current state |
| 422 | Unprocessable Entity | Business validation error |
| 429 | Too Many Requests | Rate limit exceeded |

### Server Errors (5xx)

| Code | Name | Description |
|------|------|-------------|
| 500 | Internal Server Error | Unexpected server error |
| 502 | Bad Gateway | Upstream service error |
| 503 | Service Unavailable | Service temporarily unavailable |
| 504 | Gateway Timeout | Upstream service timeout |

## Error Codes

### Authentication

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `UNAUTHORIZED` | 401 | Token not provided | Include Authorization header |
| `INVALID_TOKEN` | 401 | Malformed or invalid token | Verify token format |
| `TOKEN_EXPIRED` | 401 | Expired token | Renew with refresh token |
| `INVALID_SESSION` | 401 | Invalid session token | Regenerate session token |
| `FORBIDDEN` | 403 | No permissions | Verify user role |
| `ORGANIZATION_MISMATCH` | 403 | Incorrect organization | Use token from correct organization |

### Validation

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `VALIDATION_ERROR` | 400 | Field validation error | Review fields in `details` |
| `MISSING_FIELD` | 400 | Required field missing | Include indicated field |
| `INVALID_FORMAT` | 400 | Incorrect field format | Correct format per spec |
| `INVALID_ENUM` | 400 | Value not allowed | Use value from allowed list |

### Resources

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `NOT_FOUND` | 404 | Resource doesn't exist | Verify resource ID |
| `ALREADY_EXISTS` | 409 | Duplicate resource | Use existing resource or change identifier |
| `CONFLICT` | 409 | State conflict | Refresh and retry |

### Business

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `COMPANY_NOT_READY` | 422 | Database not provisioned | Wait for `databaseStatus` to be `ready` |
| `ONBOARDING_INCOMPLETE` | 422 | Pending onboarding | Complete onboarding flow |
| `PLAN_LIMIT_EXCEEDED` | 422 | Plan limit reached | Upgrade plan or contact support |
| `CASE_ARCHIVED` | 422 | Archived case | Archived cases cannot be modified |

### Rate Limiting

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `RATE_LIMIT_EXCEEDED` | 429 | Too many requests | Wait and retry with backoff |

### Server

| Code | HTTP | Description | Solution |
|------|------|-------------|----------|
| `INTERNAL_ERROR` | 500 | Internal error | Retry or contact support |
| `DATABASE_ERROR` | 500 | Database error | Retry |
| `EXTERNAL_SERVICE_ERROR` | 502 | External service error | Retry later |
| `SERVICE_UNAVAILABLE` | 503 | Service unavailable | Retry later |

## Error Examples

### Validation Error

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation error in submitted data",
    "details": {
      "errors": [
        {
          "field": "expediente",
          "message": "Invalid expediente format",
          "constraint": "pattern",
          "expected": "XXXXX-XXXX-X-XXXX-XX-XX-XX"
        },
        {
          "field": "riskLevel",
          "message": "Value not allowed",
          "constraint": "enum",
          "allowed": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
        }
      ]
    }
  }
}
```

### Authentication Error

```json
{
  "error": {
    "code": "TOKEN_EXPIRED",
    "message": "The access token has expired",
    "details": {
      "expiredAt": "2025-01-02T10:00:00Z",
      "hint": "Use the refresh token to obtain a new access token"
    }
  }
}
```

### Resource Not Found Error

```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "The requested case does not exist",
    "details": {
      "resource": "Case",
      "id": "case_abc123"
    }
  }
}
```

### Rate Limit Error

```json
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "You have exceeded the request limit",
    "details": {
      "limit": 100,
      "window": "1 minute",
      "retryAfter": 45
    }
  }
}
```

## Error Handling in Code

### JavaScript/TypeScript

```typescript
async function fetchCases() {
  const response = await fetch('https://api.clamo.dev/v1/cases', {
    headers: {
      'Authorization': `Bearer ${token}`,
    },
  });

  if (!response.ok) {
    const { error } = await response.json();
    
    switch (error.code) {
      case 'TOKEN_EXPIRED':
        // Renew token and retry
        await refreshToken();
        return fetchCases();
        
      case 'RATE_LIMIT_EXCEEDED':
        // Wait and retry
        const retryAfter = error.details.retryAfter * 1000;
        await new Promise(resolve => setTimeout(resolve, retryAfter));
        return fetchCases();
        
      case 'VALIDATION_ERROR':
        // Show errors to user
        error.details.errors.forEach(err => {
          console.error(`${err.field}: ${err.message}`);
        });
        throw new ValidationError(error.details.errors);
        
      default:
        throw new ApiError(error.code, error.message);
    }
  }

  return response.json();
}
```

### Python

```python
import httpx
import time

def fetch_cases(token):
    response = httpx.get(
        "https://api.clamo.dev/v1/cases",
        headers={
            "Authorization": f"Bearer {token}",
        }
    )
    
    if response.status_code >= 400:
        error = response.json()["error"]
        
        if error["code"] == "TOKEN_EXPIRED":
            new_token = refresh_token()
            return fetch_cases(new_token)
            
        elif error["code"] == "RATE_LIMIT_EXCEEDED":
            retry_after = error["details"]["retryAfter"]
            time.sleep(retry_after)
            return fetch_cases(token)
            
        elif error["code"] == "VALIDATION_ERROR":
            for err in error["details"]["errors"]:
                print(f"{err['field']}: {err['message']}")
            raise ValidationError(error["details"]["errors"])
            
        else:
            raise ApiError(error["code"], error["message"])
    
    return response.json()
```

## Retry with Exponential Backoff

For transient errors (5xx, rate limits), implement retry with backoff:

```typescript
async function fetchWithRetry(
  url: string,
  options: RequestInit,
  maxRetries = 3
) {
  let lastError: Error;
  
  for (let attempt = 0; attempt < maxRetries; attempt++) {
    try {
      const response = await fetch(url, options);
      
      if (response.status === 429) {
        const { error } = await response.json();
        const retryAfter = error.details?.retryAfter || Math.pow(2, attempt);
        await new Promise(r => setTimeout(r, retryAfter * 1000));
        continue;
      }
      
      if (response.status >= 500) {
        const backoff = Math.pow(2, attempt) * 1000;
        await new Promise(r => setTimeout(r, backoff));
        continue;
      }
      
      return response;
    } catch (error) {
      lastError = error as Error;
      const backoff = Math.pow(2, attempt) * 1000;
      await new Promise(r => setTimeout(r, backoff));
    }
  }
  
  throw lastError!;
}
```

## Diagnostic Headers

Responses include useful headers for debugging:

| Header | Description |
|--------|-------------|
| `X-Request-Id` | Unique request ID |
| `X-RateLimit-Limit` | Request limit |
| `X-RateLimit-Remaining` | Remaining requests |
| `X-RateLimit-Reset` | Reset timestamp |

Include the `X-Request-Id` when contacting support to facilitate diagnosis.

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Quick Start"
    icon="rocket"
    href="/en/getting-started/quick-start"
  >
    Start integrating with the APIs.
  </Card>
  <Card
    title="Error Guide"
    icon="book"
    href="/en/guides/errors"
  >
    Complete error handling guide.
  </Card>
</CardGroup>
