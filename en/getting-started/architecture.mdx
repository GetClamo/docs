---
title: Architecture
description: Overview of the components and services that make up the Clamo platform
---

# System Architecture

Clamo is built as a distributed microservices architecture, optimized for legal data processing and multi-tenant scalability.

## General Diagram

```mermaid
flowchart TB
    subgraph Frontend [Frontend Layer]
        WebApp[clamo-web-app<br/>Next.js 15]
        UI[clamo-ui<br/>Components]
    end

    subgraph API [API Layer]
        Tenant[clamo-tenant<br/>Hono/TypeScript]
        Cases[clamo-cases<br/>Hono/TypeScript]
        Mailing[clamo-mailing<br/>React Email]
        Dashboards[clamo-dashboards<br/>Rust/Axum]
        Widget[clamo-widget-server<br/>TypeScript]
    end

    subgraph AI [Unified AI Assistant]
        AskClamo[luna / ask-clamo<br/>LangGraph Platform]
        subgraph Profiles [Profiles]
            Javi[Javi<br/>Cases]
            Clamy[Clamy<br/>Analytics]
            Luna[Luna<br/>Global]
        end
        ClamoTools[clamo-tools<br/>Olive Framework]
    end

    subgraph Pipeline [Data Pipeline]
        CEJ[clamo-cej-connector<br/>Python/Temporal]
        Discovery[clamo-cej-discovery<br/>Python]
        Sync[clamo-sync<br/>Rust]
    end

    subgraph Storage [Storage]
        DB[(clamo-database<br/>Neon PostgreSQL)]
        Analytics[(clamo-clickhouse<br/>Tinybird)]
    end

    WebApp --> Tenant
    WebApp --> Cases
    WebApp --> AskClamo
    Tenant --> DB
    Cases --> DB
    CEJ --> DB
    Sync --> Analytics
    AskClamo --> ClamoTools
    ClamoTools --> Cases
```

## Components by Layer

### Frontend Layer

| Service | Technology | Description |
|---------|------------|-------------|
| `clamo-web-app` | Next.js 15, React 19 | Main web application with dashboard, case management, and onboarding |
| `clamo-ui` | React, Radix UI | Shared component library |

### API Layer

| Service | Technology | Port | Description |
|---------|------------|------|-------------|
| `clamo-tenant` | Hono, TypeScript | 4001 | Company, user, onboarding, and configuration management |
| `clamo-cases` | Hono, TypeScript | 4000 | CRUD for cases, movements, milestones, and documents |
| `clamo-mailing` | Hono, React Email | 4002 | Transactional emails and notifications |
| `clamo-dashboards` | Rust, Axum | 8020 | Dashboard and customizable widgets API |
| `clamo-widget-server` | TypeScript | 3005 | Embeddable widgets server |

### Unified AI Assistant

| Service | Technology | Description |
|---------|------------|-------------|
| `luna` / `ask-clamo` | LangGraph, Python | Unified service containing the Javi, Clamy, and Luna profiles |
| `clamo-tools` | Python, Olive | Remote tools server for the AI assistant |

<Note>
**Unified Architecture:** Javi, Clamy, and Luna are no longer separate services. They are **profiles** (tool profiles) within the unified `luna` service. The frontend sends `assistant_name` in the request to select the active profile.
</Note>

### Data Pipeline

| Service | Technology | Description |
|---------|------------|-------------|
| `clamo-cej-connector` | Python, Temporal | CEJ scraping with browser automation and LLM normalization |
| `clamo-cej-discovery` | Python | Discovery of new cases by RUC |
| `clamo-sync` | Rust | Data synchronization to Tinybird for analytics |

### Storage

| Service | Technology | Description |
|---------|------------|-------------|
| `clamo-database` | Prisma, Neon | Schemas and migrations for multi-tenant database |
| `clamo-clickhouse` | Tinybird | Datasources and pipes configuration for analytics |

## Multi-Tenant Model

Clamo implements a **database-per-tenant** model using Neon PostgreSQL:

```mermaid
flowchart LR
    subgraph Control [Control Database - Supabase]
        Companies[Companies]
        Users[Users]
        CompanyDB[CompanyDatabase]
        Vault[Vault Secrets]
    end

    subgraph Tenants [Tenant Databases - Neon]
        T1[(Tenant 1<br/>Branch)]
        T2[(Tenant 2<br/>Branch)]
        T3[(Tenant 3<br/>Branch)]
    end

    CompanyDB --> T1
    CompanyDB --> T2
    CompanyDB --> T3
```

### Provisioning Flow

1. Admin creates a company in the admin panel
2. `clamo-tenant` creates an Organization in WorkOS
3. A new branch is provisioned in Neon
4. Credentials are stored in Supabase Vault
5. Invitation is sent to the company administrator

## CEJ Data Flow

```mermaid
sequenceDiagram
    participant S as Scheduler
    participant CEJ as clamo-cej-connector
    participant T as Temporal
    participant LLM as Anthropic
    participant K as Kafka
    participant Cases as clamo-cases
    participant DB as Neon Database

    S->>CEJ: Trigger job
    CEJ->>T: Start workflow
    T->>CEJ: Browser search (Steel)
    CEJ->>CEJ: Parse HTML
    CEJ->>LLM: Normalize data
    LLM-->>CEJ: Structured payload
    CEJ->>K: Publish CASE_READY
    K->>Cases: Consume event
    Cases->>DB: Batch insert (COPY)
```

## Authentication and Security

- **WorkOS AuthKit**: SSO, invitations, and organization management
- **Supabase Vault**: Secure storage of secrets and credentials
- **Row Level Security**: Data isolation by tenant in queries

## Service SDKs

API contracts packages have been deprecated. All services now use **service SDKs** for API communication:

| Language | Tenant SDK | Cases SDK |
|----------|------------|-----------|
| TypeScript | `@getclamo/tenant` | `@getclamo/cases` |
| Python | `clamo-tenant-sdk-py` | `clamo-cases-sdk-py` |
| Rust | `clamo-tenant-sdk-rust` | `clamo-cases-sdk-rust` |

### SDK Repositories

- **TypeScript**: `GetClamo/clamo-tenant-sdk-ts`, `GetClamo/clamo-cases-sdk-ts`
- **Python**: `GetClamo/clamo-tenant-sdk-py`, `GetClamo/clamo-cases-sdk-py`
- **Rust**: `GetClamo/clamo-tenant-sdk-rust`, `GetClamo/clamo-cases-sdk-rust`

### Shared Packages

| Package | Description |
|---------|-------------|
| `@getclamo/database` | Prisma client and database utilities |
| `@getclamo/widget-core` | Widget definitions and schemas |
| `@getclamo/widget-ui` | Widget React components |

## Next Steps

<CardGroup cols={2}>
  <Card
    title="Quickstart"
    icon="rocket"
    href="/en/getting-started/quickstart"
  >
    Start integrating with Clamo APIs.
  </Card>
  <Card
    title="Data Pipeline"
    icon="diagram-project"
    href="/en/architecture/data-pipeline"
  >
    Complete extraction and ingestion flow.
  </Card>
</CardGroup>

